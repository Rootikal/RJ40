async function fetchScores() {
    try {
        const response = await fetch(sheetUrl);
        const data = await response.text();

        // Parse CSV and normalize data
        const rows = data.replace(/\r/g, '').split('\n').map(row => {
            return row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g).map(cell => cell.replace(/(^"|"$)/g, '').trim());
        });

        // Sort rows by score in descending order
        const sortedRows = rows.slice(1).sort((a, b) => parseFloat(b[4]) - parseFloat(a[4]));

        // Clear previous scoreboard
        const leftSection = document.getElementById('left-section');
        const rightSection = document.getElementById('right-section');
        leftSection.innerHTML = '';
        rightSection.innerHTML = '';

        // Populate the large image section with the highest score
        const [topContestant, ...remainingContestants] = sortedRows;

        if (topContestant) {
            const [contestant, , , , total, url] = topContestant;

            const largeImageDiv = document.createElement('div');
            largeImageDiv.className = 'large-image';

            const largeImg = document.createElement('img');
            largeImg.src = url;
            largeImg.alt = contestant;
            largeImg.style.setProperty('--rotate-angle', `${Math.random() * 10 - 5}deg`);

            const largeScore = document.createElement('div');
            largeScore.className = 'large-score';
            largeScore.textContent = total;

            largeImageDiv.appendChild(largeImg);
            largeImageDiv.appendChild(largeScore);

            rightSection.appendChild(largeImageDiv);
        }

        // Split remaining contestants into two rows
        const half = Math.ceil(remainingContestants.length / 2);
        const topRow = remainingContestants.slice(0, half).reverse(); // Reverse order for the top row
        const bottomRow = remainingContestants.slice(half).reverse(); // Reverse order for the bottom row

        // Helper function to create contestant divs
        const createContestantDiv = (contestant, total, url) => {
            const contestantDiv = document.createElement('div');
            contestantDiv.className = 'contestant';

            const img = document.createElement('img');
            img.src = url;
            img.alt = contestant;
            img.style.setProperty('--rotate-angle', `${Math.random() * 10 - 5}deg`);

            const score = document.createElement('div');
            score.className = 'score';
            score.textContent = total;

            contestantDiv.appendChild(img);
            contestantDiv.appendChild(score);

            return contestantDiv;
        };

        // Add contestants to the left section in reversed order for each row
        [...topRow, ...bottomRow].forEach(([contestant, , , , total, url]) => {
            if (!contestant || !url || isNaN(total)) {
                console.warn('Skipping invalid row:', row);
                return;
            }
            leftSection.appendChild(createContestantDiv(contestant, total, url));
        });
    } catch (error) {
        console.error('Error fetching data:', error);
        alert('Failed to fetch scoreboard data. Please check your sheet permissions and try again.');
    }
}


