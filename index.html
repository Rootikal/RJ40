async function fetchScores() {
    const fallbackUrl = `https://docs.google.com/spreadsheets/d/1z4UHaz7ReS5LM56XsN2rqMDuAPaPHl6-rOCUJ3eNVKU/export?format=csv`;

    try {
        const response = await fetch(sheetUrl); // Try the gviz/tq URL
        if (!response.ok) {
            console.error('Failed with gviz/tq URL. Trying fallback URL...');
            return await fetchFallback(fallbackUrl);
        }

        const data = await response.text();
        processCSVData(data); // Function to process and render the scoreboard
    } catch (error) {
        console.error('Error fetching data:', error);
        alert('Failed to fetch scoreboard data. Please check your sheet permissions and try again.');
    }
}

async function fetchFallback(url) {
    try {
        const response = await fetch(url);
        const data = await response.text();
        processCSVData(data);
    } catch (error) {
        console.error('Error with fallback URL:', error);
        alert('Both primary and fallback URLs failed.');
    }
}

function processCSVData(data) {
    const rows = data.replace(/\r/g, '').split('\n').map(row => row.split(','));
    const scoreboard = document.getElementById('scoreboard');
    scoreboard.innerHTML = ''; // Clear previous content

    rows.slice(1).forEach(row => {
        const [contestant, task1, task2, task3, total, url] = row;

        // Debugging logs
        console.log('Row Data:', { contestant, task1, task2, task3, total, url });

        // Trim the total value to remove any extra spaces
        const totalTrimmed = total.trim();
        console.log('Trimmed Total:', totalTrimmed);

        // Skip rows if contestant or URL is missing, or total is not a valid number
        if (!contestant || !url || isNaN(totalTrimmed) || totalTrimmed === '') {
            console.log(`Skipping invalid contestant: ${contestant} (total: ${totalTrimmed}, url: ${url})`);
            return;
        }

        // Create contestant div and append image and score
        const contestantDiv = document.createElement('div');
        contestantDiv.className = 'contestant';

        const img = document.createElement('img');
        img.src = url.trim();
        img.alt = contestant;

        const score = document.createElement('div');
        score.className = 'score';
        score.textContent = totalTrimmed; // Use trimmed total

        contestantDiv.appendChild(img);
        contestantDiv.appendChild(score);
        scoreboard.appendChild(contestantDiv);
    });
}
